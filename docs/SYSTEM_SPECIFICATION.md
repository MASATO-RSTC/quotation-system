# 見積書作成システム仕様書兼要件定義ドキュメント

## 1. システム概要

本システムは、エンジニア派遣における見積書作成業務を効率化するためのWebアプリケーションです。複雑な単価計算ロジック（時給・月給、各種割増・控除、丸め処理など）を自動化し、データの一元管理と運用ルールの統一を目指します。

## 2. 見積書入力フォーム (`src/app/page.tsx`)

### 2.1. フォームの構成と項目

- **スタッフ・契約情報**
  - `契約種別` (ドロップダウン選択: 「時給」, 「月時（上限あり下限あり）」, 「月時（完全固定）」, etc.)
- **丸め・精算設定**
  - `金額丸め単位`, `丸め方法` - **「月時（完全固定）」では非表示**

（その他、契約種別に応じて多数の項目が表示/非表示に切り替わる）

## 3. 計算ロジック (`src/utils/calculations.ts`)

- **月時（完全固定）**: 計算処理は行われない。

## 4. PDF出力 (`src/utils/generateQuotationPdf.ts`)

- **明細テーブル**:
    - **月時（上限あり下限あり）契約**: 月給単価、時間幅（例: 140h 〜 180h）、超過単価、控除単価を表示。
    - **月時（上限あり下限なし）契約**: 月給単価、時間幅（例: 下限なし〜180h）、超過単価を表示。
    - **月時（上限なし下限あり）契約**: 月給単価、時間幅（例: 140h〜上限なし）、控除単価を表示。
    - **月時（完全固定）契約**: 月給単価、時間幅（「完全固定」と表示）を表示。

## 6. 契約種別ごとの詳細仕様

### 6.2. 月時契約

#### 6.2.1. 月時（上限あり下限あり）
*   **概要:** 上限と下限を設けた契約形態。

#### 6.2.2. 月時（上限あり下限なし）
*   **概要:** 上限のみを設けた契約形態。

#### 6.2.3. 月時（上限なし下限あり）
*   **概要:** 下限のみを設けた契約形態。

#### 6.2.4. 月時（完全固定）
*   **概要:** 時間による超過・控除の概念がない完全固定の月給制。
*   **入力項目:** `月給単価`など基本項目のみ。時間や可変単価に関する項目はすべて非表示となる。
*   **PDF表示:** 明細テーブルの「時間幅」は「完全固定」と表示される。

#### 6.2.5. 月時（上限下限変動あり）
*   **概要:** 月の労働日数と1日の労働時間から基準時間を算出し、そこからの差分で上限・下限時間を設定する契約形態。
*   **追加入力項目:**
    *   `労働日数/月`: 基準時間計算のための月の労働日数。
    *   `労働時間/日`: 基準時間計算のための1日の労働時間。
    *   `下限時間（差分）`: 基準時間から引かれる時間数。（例: 20 を入力すると `基準時間 - 20h` が下限時間となる）
    *   `上限時間（差分）`: 基準時間に足される時間数。（例: 20 を入力すると `基準時間 + 20h` が上限時間となる）
    *   `計算タイプ`: 特記事項に表示するための計算式の種類を選択する。（計算結果には影響しない）
*   **計算ロジック:**
    *   基準時間 = `労働日数/月` × `労働時間/日`
    *   上限時間 = `基準時間` + `上限時間（差分）`
    *   下限時間 = `基準時間` - `下限時間（差分）`
    *   超過・控除単価は、上記で計算された上限・下限時間と、既存の「月時（上限あり下限あり）」と同様のロジックで計算される。
*   **PDF表示:**
    *   **明細テーブル:**
        *   `超過単価`: 割増係数適用後の金額が表示される。括弧内に割増前の単価も併記される。例: `¥2,500 (¥2,000)`
        *   `控除単価`: 計算された控除単価が表示される。
        *   `深夜手当`, `法定休日出勤`などの各種割増単価が表示される。
    *   **特記事項:**
        *   `単価計算方法`の項目に、選択した計算タイプが括弧付きで表示される。その際、入力された労働日数と労働時間も反映される。
        '''        '''        *   例: `▼ 単価計算方法（出勤日数:20日 × 所定労働時間:8h）`

#### 6.2.7. 月時（上限変動なし、下限変動あり）
*   **概要:** 月の労働日数と1日の労働時間から基準時間（＝上限時間）を算出し、そこからの差分で下限時間を設定する契約形態。
*   **追加入力項目:**
    *   `労働日数/月`: 基準時間計算のための月の労働日数。
    *   `労働時間/日`: 基準時間計算のための1日の労働時間。
    *   `下限時間（差分）`: 基準時間から引かれる時間数。（例: 20 を入力すると `基準時間 - 20h` が下限時間となる）
    *   `計算タイプ`: 特記事項に表示するための計算式の種類を選択する。（計算結果には影響しない）
*   **計算ロジック:**
    *   上限時間（基準時間） = `労働日数/月` × `労働時間/日`
    *   下限時間 = `上限時間` - `下限時間（差分）`
    *   超過・控除単価は、上記で計算された上限・下限時間と、既存の「月時（上限あり下限あり）」と同様のロジックで計算される。
*   **PDF表示:**
    *   **明細テーブル:**
        *   `時間幅`: `下限時間h 〜 上限時間h` の形式で表示される。
        *   `超過単価`: 割増係数適用後の金額が表示される。括弧内に割増前の単価も併記される。
        *   `控除単価`: 計算された控除単価が表示される。
        *   各種割増単価が表示される。
    *   **特記事項:**
        *   `単価計算方法`の項目に、選択した計算タイプが括弧付きで表示される。その際、入力された労働日数と労働時間も反映される。'''

#### 6.2.6. 月時（上限変動あり、下限変動なし）
*   **概要:** 月の労働日数と1日の労働時間から基準時間（＝下限時間）を算出し、そこからの差分で上限時間を設定する契約形態。
*   **追加入力項目:**
    *   `労働日数/月`: 基準時間計算のための月の労働日数。
    *   `労働時間/日`: 基準時間計算のための1日の労働時間。
    *   `上限時間（差分）`: 基準時間に足される時間数。（例: 20 を入力すると `基準時間 + 20h` が上限時間となる）
    *   `計算タイプ`: 特記事項に表示するための計算式の種類を選択する。（計算結果には影響しない）
*   **計算ロジック:**
    *   下限時間（基準時間） = `労働日数/月` × `労働時間/日`
    *   上限時間 = `下限時間` + `上限時間（差分）`
    *   超過・控除単価は、上記で計算された上限・下限時間と、既存の「月時（上限あり下限あり）」と同様のロジックで計算される。
*   **PDF表示:**
    *   **明細テーブル:**
        *   `時間幅`: `下限時間h 〜 上限時間h` の形式で表示される。
        *   `超過単価`: 割増係数適用後の金額が表示される。括弧内に割増前の単価も併記される。
        *   `控除単価`: 計算された控除単価が表示される。
        *   各種割増単価が表示される。
    *   **特記事項:**
        *   `単価計算方法`の項目に、選択した計算タイプが括弧付きで表示される。その際、入力された労働日数と労働時間も反映される。'''