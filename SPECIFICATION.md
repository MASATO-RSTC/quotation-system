# 見積書作成システム仕様書

## 1. 見積書入力フォーム (`src/app/page.tsx`)

### 1.1. フォームの構成と項目

フォームは以下のセクションで構成される。

- **基本情報**
  - `見積書No.` (自動生成、読み取り専用)
  - `作成日` (日付選択)
  - `有効期限` (日付選択)
- **顧客情報**
  - `企業名` (テキスト入力, 必須)
  - `部署名` (テキスト入力)
  - `担当者氏名` (テキスト入力)
- **スタッフ・契約情報**
  - `スタッフ氏名` (テキスト入力, 必須)
  - `ご請求単価 (/時)` (数値入力, 必須)
  - `業務内容` (テキストエリア, 必須)
  - `契約開始日` (日付選択, 必須)
  - `契約終了日` (日付選択, 必須)
- **割増率設定**
  - `普通残業` (数値入力)
  - `深夜手当` (数値入力)
  - `法定休日出勤` (数値入力)
  - `法定外休日出勤` (数値入力)
  - `60時間超過` (数値入力)
- **丸め・精算設定** (全て必須)
  - `金額丸め単位` (ドロップダウン選択: 1, 10, 100, 1000)
  - `丸め方法` (ドロップダウン選択: 切り捨て, 切り上げ, 四捨五入)
  - `時間精算単位` (ドロップダウン選択: 1, 3, 5, 10, 15, 30, 45, 60)
  - `精算丸め` (ドロップダウン選択: 切り捨て, 切り上げ, 四捨五入)
- **計算結果** (自動計算・表示専用)
  - `普通残業単価`
  - `深夜手当単価`
  - `法定休日出勤単価`
  - `法定外休日出勤単価`
  - `60時間超過単価`
- **特記事項**
  - `特記事項` (テキストエリア)
- **発行元**
  - `発行元` (テキストエリア)

### 1.2. 初期値と動的挙動

- **日付関連**:
  - `作成日`: 現在の日付。
  - `有効期限`: 作成日の1ヶ月後。
  - `契約開始日`: 当月の1日。
  - `契約終了日`: 当月の3ヶ月後の末日。(※要修正: 2ヶ月後に変更予定)
- **単価・割増率**:
  - `ご請求単価`: `5000` が設定されている。(※要修正: 空白に変更予定)
  - `割増率`: それぞれ標準的な値 (1.25, 0.25など) が設定されている。
  - `割増率`の入力欄からフォーカスが外れた際、値が空白の場合は自動的に `0` が入力される。
- **発行元情報**: 株式会社リツアンSTCの連絡先が設定されている。(※要修正: 改行位置を調整予定)
- **計算結果**: `ご請求単価`や`割増率`を変更すると、リアルタイムで計算結果が更新される。計算結果が0円の場合は `-` と表示される。
- **PDF生成ボタン**: ボタンクリック後、PDFの生成が完了するまで「生成中...」と表示され、ボタンは無効化される。

## 2. PDF出力 (`src/utils/generateQuotationPdf.ts`)

### 2.1. 全体設定

- **ファイル名**: `御見積書.pdf`
- **フォント**: `Noto Sans JP` を使用。パフォーマンス低下を防ぐため、PDF生成時にフォントデータを動的に読み込む。

### 2.2. レイアウトとコンテンツ

1.  **ヘッダー**:
    - 中央に「御見積書」というタイトルを配置。
    - 左上にロゴ画像 (`ritsuan_logo.png`) を配置。
2.  **情報ブロック**:
    - **左側**: `見積番号`, `作成日`, `有効期限` を表示。
    - **右側**: 「【発行元】」というタイトルを付け、その下に発行元情報を表示。行間は左側の情報ブロックと揃える。発行元情報の右側には、文字と重ならないように少し小さくした印鑑画像 (`inkan.png`) を配置。
3.  **宛先ブロック**:
    - `▪御社名： {企業名} 御中` の形式で表示。
    - `部署名`が入力されている場合のみ、`▪部署名： {部署名}` を表示。
    - `担当者氏名`が入力されている場合のみ、`▪ご担当者様： {担当者氏名} 様` を表示。
4.  **挨拶**:
    - 中央に「下記の通り御見積申し上げます」と表示。
5.  **明細テーブル**:
    - テーブルの上に「【御見積詳細】」というタイトルを配置。
    - ヘッダーは「項目」「内容」。（※現状、文字化けしており修正が必要）
    - 本体には、スタッフ名、契約期間、業務内容、各種単価などを表示。単価が0の場合は `-` と表示。
6.  **特記事項ブロック**:
    - 「【特記事項】」というタイトルを配置。
    - グレーの枠線で囲み、内部に余白を設ける。
    - フォームで選択された設定に基づき、「精算単位はXX分、XX。精算金額はXX円単位、XX。」という一文を自動生成し、その下に手入力された特記事項を表示。

## 3. 計算ロジック (`src/utils/calculations.ts`)

- `ご請求単価`と各種`割増率`を基に、それぞれの割増単価を計算する。
- 計算された金額は、フォームで指定された`金額丸め単位`と`丸め方法`に基づいて端数処理される。
